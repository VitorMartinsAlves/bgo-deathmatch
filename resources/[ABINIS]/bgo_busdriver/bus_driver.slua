----------------------------------------->>
-- Grand Theft International (GTi)
-- Author: JT Pennington (JTPenn)
-- Date: 27 Jul 2014
-- Resource: busdriver/bus_driver.slua
-- Version: 1.0
----------------------------------------->>

local vehIDs = {
	[431] = 1.000,	-- Bus
		-- 142 stops/hour
	[437] = 1.000,	-- Coach
		-- 142 stops/hour
}

local TIME_BTWN_CHAT = 1000	-- How often a person can use the radio
local radioSpam = {}	-- Table of Last Radio Chat

-- Complete Mission
-------------------->>
	
	
	
	local blip = createBlip (1225.6229248047,-1815.5437011719,16.59375, 42)
	setElementData(blip,"blipName", "Motorista de ônibus")
		
		
function completeMission()
	local vehicle = getPedOccupiedVehicle(client)
	
--[[

	local pay = 400
	setElementData(client,"char:money", getElementData(client,"char:money") + pay)
	exports.bgo_hud:dm("Você Ganhou +R$"..pay.." por chegar no ponto!", client, 255, 200, 0)
	
	local ganho = 300
	exports.bgo_Level:givePlayerExp(client, ganho )

]]--

	exports.bgo_admin:setPlayerPagamento(client)
	
	
end
addEvent("busdriver.completeMission", true)
addEventHandler("busdriver.completeMission", root, completeMission)

-- Job Radio
------------->>

function busDriverRadio(player, cmd, ...)
	if (exports.bgo_employment:getPlayerJob(player, true) ~= "Motorista") then return end
	if (radioSpam[player]) then 
		outputChatBox("Você só pode usar o rádio uma vez a cada segundo.", player, 255, 25, 25)
	return end
	
	local message = table.concat({...}, " ")
	if (string.gsub(message, "%s", "") == "") then return end
	
	radioSpam[player] = true
	setTimer(function(player) radioSpam[player] = nil end, TIME_BTWN_CHAT, 1, player)
	
	for i,plr in ipairs(getElementsByType("player")) do
		if (exports.bgo_employment:getPlayerJob(plr, true) == "Motorista") then
			outputChatBox("* (RADIO): "..getPlayerName(player)..": #FFFFFF"..message..", câmbio.", plr, 255, 175, 0, true)
		end
	end
end
addCommandHandler("r", busDriverRadio)

timer = {}
v = {}

function removeHelmetOnExit ( thePlayer, seat, jacked )
    if ( getElementModel ( source ) == 431 ) then -- if its a nrg
         if (getElementData(thePlayer, "job") == "Motorista") then
                     v[thePlayer] = setTimer(vVehicle, 3000, 1, thePlayer, getPedOccupiedVehicle(thePlayer))
		 end
    end
end
addEventHandler ( "onVehicleStartExit", getRootElement(), removeHelmetOnExit )

function vVehicle ( thePlayer, busD )
local theVehicle = getPedOccupiedVehicle ( thePlayer )
         if not theVehicle then
               	      outputChatBox("#FFA000*#FFFFFFVocê tem #FFA00010 Segundos #FFFFFFpara entrar no veiculo novamente", thePlayer, 255,255,255, true)
         	      exports.bgo_hud:dm("*Você tem 10 Segundos para entrar no veiculo novamente", thePlayer, 255, 255, 255)
                      timer[thePlayer] = setTimer(destroyBus, 10000, 1, thePlayer, busD)
         end
end

function destroyBus (thePlayer, bus)
local theVehicle = getPedOccupiedVehicle ( thePlayer )
     if bus then
         if not theVehicle then
              destroyElement(bus)
         end
     end
end

function addHelmetOnEnter ( thePlayer, seat, jacked )
    if ( getElementModel ( source ) == 431 ) then
         if isTimer(timer[thePlayer]) then
		     killTimer(timer[thePlayer])
		 end
    end
end
addEventHandler ( "onVehicleEnter", getRootElement(), addHelmetOnEnter )

function notifyAboutExplosion()
     if ( getElementModel ( source ) == 431 ) then
	     destroyElement(source)
	 end
end
addEventHandler("onVehicleExplode", getRootElement(), notifyAboutExplosion)